/**
 * This file has been generated using TS-CLI.
 * This file contains the service to Create, Read, Update and Delete %Model_NAME% Objects.
 */

import { Injectable, Inject } from '@nestjs/common';
import { Model } from 'mongoose';
import { InjectModel } from '@nestjs/mongoose';
import { Observable, of, from, throwError } from 'rxjs';
import { switchMap, mergeMap, concatMap, map, toArray } from 'rxjs/operators';
import { %Model_NAME% } from '../models/%model_NAME%.model';
import { I%Model_NAME%DBO } from '../dbo/%model_NAME%.schema';
import { %Model_NAME%Mapper } from '../mappers/%model_NAME%.mapper';

@Injectable()
export class %Models_NAME%Service {

  constructor(
    @InjectModel('%MODEL_NAME%_MODEL') private %model_NAME%Model: Model<I%Model_NAME%DBO>,
  ) {

  }

  /**
   * Create a %Model_NAME% Object in the database
   * @param data information to record in the database
   */
  public create(user: string): Observable<%Model_NAME%> {
    return of(%Model_NAME%Mapper.createDBO({
      id: undefined,
      softDeleted: false,
      creationDate: undefined,
      lastModificationDate: undefined,
      lastModificationBy: user,
    })).pipe(
      switchMap((%model_NAME%: I%Model_NAME%DBO) => {
        %model_NAME%.save();
        return of(%model_NAME%);
      }),
      switchMap((%model_NAME%: I%Model_NAME%DBO) => of(%Model_NAME%Mapper.fromDBO(%model_NAME%))));
  }

  /**
   * Get a %Model_NAME% Object based on its UID
   * @param id the UID of the Object
   */
  public getById(id: string): Observable<%Model_NAME%> {
    return from(this.%model_NAME%Model.findOne({ id })).pipe(
      switchMap((dbo: I%Model_NAME%DBO) => {
        if (dbo === null) {
          return throwError(new Error(`No %model_NAME% with id ${id} was found`));
        }
        return of(%Model_NAME%Mapper.fromDBO(dbo));
      }),
    );
  }

  /**
   * Get all the %Model_NAME% considering a pagintation
   */
  /*
  public getAll(): Observable<%Model_NAME%[]> {
    return from(this.%model_NAME%Model.findOne().exec()).pipe(
      concatMap((%model_NAME%: I%Model_NAME%DBO) => of(%model_NAME%)),
      map((dbo: I%Model_NAME%DBO) => %Model_NAME%Mapper.fromDBO(dbo)),
      toArray(),
    );
  }
  */

}
